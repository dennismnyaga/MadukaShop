{% extends 'shopapp/main.html' %}
{% load static %}
{% load humanize %}
<script>
  const links = document.querySelectorAll('.category-link');
  links.forEach(link => {
      link.addEventListener('click', e => {
          links.forEach(link => link.classList.remove('active'));
          link.classList.add('active');
      });
  });
</script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> 
{% block content %}

<div class="row">
  <div class="col-4">
    <div class="titles">
      <a href="#"><div class="featured">Featured</div></a>
      <a href="#"><div class="featured">Near you</div></a>
      <a href="{% url 'shopapp:shops' %}"><div class="featured">Shops</div></a>

    </div>
    <div class="cont">
      {% for category in categories %}
      <a class="category-link {% if category.id == active_category_id %}active{% endif %}" href="{% url 'shopapp:view_category' category.id %}">
      <div class="product-list">
        <div class="listing">
          <h4>{{category.name}}</h4>
          <p>{{ category.num_products }} Ads</p>
        </div>
        <i class="icofont-rounded-right"></i>
      </div>
      </a>
      <hr>
      {% endfor %}
      <hr>
    </div>
  </div>
  
  <div class="col-8 me-0">
    <div class="row row-cols-4 product-g">
      {% for product in products|slice:":6" %}
      
      <div class="col-md-4">
        <!-- ============================== -->
      <div class="card " style="width: 15rem;">
        {% with product.images.first as product_image %}
        <a href="{% url 'shopapp:details' product.id %}">
        <img src="{{ product_image.image.url }}" class="card-img-top" alt="{{ product.ad_title }}">
      </a>
      
      {% if user.is_authenticated %}
      {% if product in user.liked_products.all %}
      <form class="liked" id="unlike-form" action="{% url 'shopapp:like' %}" method="post">
        {% csrf_token %}
        
        <input type="hidden" name="product_id" value="{{ product.id }}">
        <button type="submit"><span class="material-symbols-outlined unlik">
          favorite
          </span></button>
        
      </form> 
      {% else %}
        <!-- Display the like button -->
        <form class="like" id="like-form" action="{% url 'shopapp:like' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="product_id" value="{{ product.id }}">
            <button type="submit"><span class="material-symbols-outlined lik">
              favorite
              </span></button>
        </form>
    {% endif %}
{% endif %}
      
        {% endwith %}
        <div class="card-body">
          <h5 class="card-title">{{product.ad_title }}</h5>
          <div class="caption">
            <div class="ro">
							<div class="price">
								<p>KES {{product.price|intcomma}}</p>
							</div>
							<div class=" pric d-flex">
								<i class="icofont-location-pin"></i>
                <p>{{ product.location }}</p>
							</div>
              <div class="pri con d-flex">
                <a class="btn btn-info " href="tel:{{product.owner.phone_number}}">CONTACT SELLER</a>
							</div>
						</div>
          </div>
          </div>
      </div>
     
      </div>
      {% endfor %}
     
     
     
      
      
    </div>
    <div class="promotion-slider">
      <div id="carouselExampleCaptions" class="carousel slide carousel-fade" data-bs-ride="carousel">
        <div class="carousel-indicators">
          <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
          <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
          <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
        </div>
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img src="{% static 'shopapp/images/pro.jpg' %}" class="d-block " alt="...">
            <div class="carousel-caption d-none d-md-block">
              <h5>Chicken Inn </h5>
              <h5>-Thika Road Mall, Roysambu</h5>
              <p class="btn btn-primary">Visit Shop</p>
            </div>
          </div>
          <div class="carousel-item">
            <img src="{% static 'shopapp/images/pro.jpg' %}" class="d-block" alt="...">
            <div class="carousel-caption d-none d-md-block">
              <h5>Second slide label</h5>
              <p class="btn btn-primary">Visit Shop</p>
            </div>
          </div>
          <div class="carousel-item">
            <img src="{% static 'shopapp/images/pro.jpg' %}" class="d-block " alt="...">
            <div class="carousel-caption d-none d-md-block">
              <h5>Third slide label</h5>
              <p class="btn btn-primary">Visit Shop</p>
            </div>
          </div>
        </div>
        
      </div>
      
    </div>
    
    <div class="row row-cols-4 product-g">
      {% for product in products|slice:"6:" %}
      
      <div class="col-md-4">
        <!-- ============================== -->
      <div class="card " style="width: 15rem;">
        {% with product.images.first as product_image %}
        <a href="{% url 'shopapp:details' product.id %}">
        <img src="{{ product_image.image.url }}" class="card-img-top" alt="{{ product.ad_title }}">
      </a>
      {% if user.is_authenticated %}
      {% if product in user.liked_products.all %}
      <form class="liked" id="unlike-form" action="{% url 'shopapp:like' %}" method="post">
        {% csrf_token %}
        
        <input type="hidden" name="product_id" value="{{ product.id }}">
        <button type="submit"><span class="material-symbols-outlined unlik">
          favorite
          </span></button>
        
      </form> 
      {% else %}
        <!-- Display the like button -->
        <form class="like" id="like-form" action="{% url 'shopapp:like' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="product_id" value="{{ product.id }}">
            <button type="submit"><span class="material-symbols-outlined lik">
              favorite
              </span></button>
        </form>
    {% endif %}
{% endif %}
        <!-- <span class="material-symbols-outlined">
          favorite
          </span> -->
      
        {% endwith %}
        <div class="card-body">
          <h5 class="card-title">{{product.ad_title }}</h5>
          <div class="caption">
            <div class="ro">
							<div class="price">
								<p>KES {{product.price|intcomma}}</p>
							</div>
							<div class=" pric d-flex">
								<i class="icofont-location-pin"></i>
                <p>{{ product.location }}</p>
							</div>
						</div>
          </div>
          </div>
      </div>
     
      </div>
      {% endfor %}
      
    </div>
    
    
  </div>
  
</div>
{% endblock content %}